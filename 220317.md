# 📚 2022.03.16 공부

## Board 게시판

### 오늘 오류난 것

-   bcrypt로 비밀번호를 암호화하는걸 어제 했었다. 근데 오늘 다시 해보니까 암호화가 되지 않은 채로 DB에 저장이 되고있었다.

#### 해결 방법

```javascript
// server/models/User.js

const userSchema = {
    ...
}

userSchema.pre("save", function (next) {
    // 저장하기전에 실행할 코드
    var user = this;
    if (user.isModified("password")) {
        // 비밀번호가 변경될때만
        bcrypt.genSalt(saltRounds, function (err, salt) {
            if (err) return next(err); // next는 바로 register로 넘어감
            bcrypt.hash(user.password, salt, function (err, hash) {
                if (err) return next(err);
                user.password = hash;
                next();
            });
        });
    } else {
        // 그 외에는 그냥 내보낸다
        next();
    }
});

const User = mongoose.model("User", userSchema);
module.exports = { User };
```

-   단순히 module.exports를 맨 마지막으로 옮기면 되는 문제였다. 원래 코드는 userSchma.pre 코드 이전에 module.exports 코드를 넣었기 때문에 그 이후 코드들이 실행이 되지 않은 모양이다.
